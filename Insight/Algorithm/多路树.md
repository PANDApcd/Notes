# 多路树(高度更低)

可以包含若干个节点的树

### 1. 2-3-4 树 （m=4)

- 一个节点可以包含1/2/3个key,并分出2/3/4个子节点
- **插入节点时避免子树高度变化**
  - 类似红黑树插入，现在叶子节点插入
  - 如果父节点超过4个叶子，就往上升（父节点等于往祖父节点插入）
- 2-3-4树可以展开为红黑树(多余的节点作为红色)



### 2. B树 (中位附近的数据查询很快)

- **数据量大**,但**常用数据接近**root时合适

- m代表每个节点的最多子节点数

- 除了根节点，每个节点至少有$\lceil m/2\rceil-1$个key,例如$m=5\rightarrow \text{ #key}=(m-1)/2$ 

- 插入时,**只有key超过m时才拆分**

  - 将节点拆分成两半，并把父节点向上插入
  - 递归向上操作(类似红黑树)

- **所有叶子节点在同一层**

- node保存在磁盘,因此一次加载很多value

  <img src="C:\Users\PANDA\AppData\Roaming\Typora\typora-user-images\image-20210421212252002.png" alt="image-20210421212252002" style="zoom:75%;" />



### 3. B+树 (m很大)

​	和B树的区别

- 非叶子节点不存放数据,**因此可以存放更多索引**
- 叶子节点有**指向下一个叶子节点的指针**(因此全遍历速度快)
- 根节点存放最大key(每个节点key数和子node数相同)

<img src="C:\Users\PANDA\AppData\Roaming\Typora\typora-user-images\image-20210421214250997.png" alt="image-20210421214250997" style="zoom:50%;" />

### 4. 数据库B树卫星数据

一个节点除了存放key之外还会**保存该行**的信息，因此会占用大量空间

因此B+树只用叶子节点保存卫星数据，使一个节点可以保存很多key**(m非常大)**



### 5. 跳跃表

- 思路来源于**地铁快慢线**(有不同长度的链表)

  <img src="C:\Users\PANDA\AppData\Roaming\Typora\typora-user-images\image-20210421221813527.png" alt="image-20210421221813527" style="zoom:50%;" />

- 在每一个链表上进行$\sqrt[k]{N}$次查询(一共有$k$层和$N$个node)  \

  **每一层长度比例是**$\bf{\sqrt[k]{N}}\approx2$ 

  $\frac{n}{q^2}+2q\rightarrow q=3\sqrt[3]{n}$

- 设置k为$\log N$可以得到$O(\log N)$的查询时间

  $\textbf{总时间}=\log N\sqrt[\log N]{N}=2\log N$

#### 插入方法

1. 在底层插入
2. 以50%概率决定是否向上提升
3. 如果提升则递归
4.  极大概率高度是$O(\log N)$ (通过布尔不等式证明)



### 6. LSM树

- 牺牲小部分读性能换高性能写
- 将数据分为内存区和磁盘



### 7. 默尔克树

每一个节点存放的是叶子节点hash后的结果,每一个节点都是256位(如果用SHA-256)

<img src="C:\Users\PANDA\AppData\Roaming\Typora\typora-user-images\image-20210515191822920.png" alt="image-20210515191822920" style="zoom:50%;" />

- 校验文档的正确性

  - 在下载前计算哈希值

- 快速定位错误

  - 发现一个节点的hash值不正确,就可以定位错误

  